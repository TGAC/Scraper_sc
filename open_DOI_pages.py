import asyncio
from playwright.async_api import async_playwright, TimeoutError as PlaywrightTimeoutError

DOIS = [
    "10.1038/s41467-023-44369-7",
    "10.1111/ppl.14508",
    "10.1016/j.xplc.2023.100554",
    "10.1111/pbi.70009",
    "10.3389/fpls.2024.1394587",
    "10.1126/science.aay4970",
    "10.1016/j.molp.2024.08.003",
    "10.1093/hr/uhab055",
    "10.1016/j.devcel.2021.03.014",
    "10.1093/plcell/koaa060",
    "10.1111/pbi.13763",
    "10.1038/s41598-021-89170-y",
    "10.1111/jipb.13435",
    "10.1016/j.molp.2024.05.001",
    "10.1093/plphys/kiae107",
    "10.1016/j.chom.2023.08.019",
    "10.1016/j.xplc.2025.101297",
    "10.1093/plcell/koab101",
    "10.1186/s13059-021-02288-0",
    "10.1126/science.abf4368",
    "10.1093/pcp/pcac167",
    "10.1038/s41477-023-01544-4",
    "10.1101/2020.09.20.305029",
    "10.1242/dev.200632",
    "10.1111/pbi.13919",
    "10.1038/s41477-023-01419-8",
    "10.1111/pbi.13891",
    "10.1101/2023.03.23.533992",
    "10.7554/eLife.95891",
    "10.3389/fpls.2025.1555388",
    "10.1111/jipb.13495",
    "10.1093/hr/uhad122",
    "10.1126/science.adf4721",
    "10.1093/plphys/kiab564",
    "10.1186/s13059-020-02094-0",
    "10.3389/fpls.2019.00589",
    "10.1101/2023.12.21.572850",
    "10.1038/s41467-021-22352-4",
    "10.1093/plphys/kiad500",
    "10.1186/s12870-024-05916-6",
    "10.1101/2023.02.27.530256",
    "10.1016/j.molp.2022.10.019",
    "10.1016/j.xplc.2022.100308",
    "10.1093/jxb/erad103",
    "10.1126/science.abj2327",
    "10.1093/hr/uhae189",
    "10.1016/j.xplc.2023.100665",
    "10.1038/s41467-023-42911-1",
    "10.1111/tpj.16319",
    "10.1038/s41477-023-01524-8",
    "10.1038/s41467-024-47329-x",
    "10.1126/sciadv.adg6983",
    "10.1111/tpj.15719",
    "10.3389/fpls.2022.1053669",
    "10.1111/pbi.14519",
    "10.1186/s13059-022-02834-4",
    "10.1111/pce.15164",
    "10.1111/pbi.13778",
    "10.1038/s41467-025-55869-z",
    "10.1111/pbi.13656",
    "10.1093/plcell/koaa055",
    "10.1016/j.celrep.2022.111699",
    "10.1016/j.celrep.2019.06.041",
    "10.1016/j.celrep.2022.111059",
    "10.1111/nph.20208",
    "10.1038/s41477-022-01291-y",
    "10.1073/pnas.2018788117",
    "10.1016/j.devcel.2019.02.022",
    "10.1038/s41477-021-00922-0",
    "10.1186/s13059-021-02537-2",
    "10.1016/j.molp.2023.02.005",
    "10.1007/s00497-018-00355-4",
    "10.1016/j.molp.2020.12.014",
    "10.1126/science.aba5531",
    "10.1071/FP20368",
    "10.1016/j.xplc.2023.100676",
    "10.3389/fpls.2024.1274013",
    "10.1186/s13059-023-02908-x",
    "10.1016/j.xplc.2023.100740",
    "10.1016/j.plantsci.2022.111535",
    "10.1016/j.devcel.2020.12.015",
    "10.1104/pp.18.01482",
    "10.1111/pce.14906",
    "10.1038/s41477-023-01387-z",
    "10.1016/j.molp.2020.06.010",
    "10.1038/s41467-025-55870-6",
    "10.1038/s41477-023-01567-x",
    "10.1093/plphys/kiab489",
    "10.3390/ijms23052759",
    "10.1038/s41477-022-01178-y",
    "10.1016/j.xplc.2024.100941",
    "10.1073/pnas.2405806121",
    "10.1111/nph.20446",
    "10.1038/s41477-024-01771-3",
    "10.1093/plphys/kiab537",
    "10.3390/genes13020374",
    "10.3390/ijms25052553",
    "10.1038/s41477-025-01938-6",
    "10.1016/j.devcel.2024.12.025",
    "10.1016/j.cell.2025.02.011",
    "10.1016/j.devcel.2024.10.023",
    "10.1016/j.cell.2025.03.024",
    "10.1016/j.devcel.2024.12.019",
    "10.1016/j.molp.2023.10.008",
    "10.1016/j.devcel.2022.01.008",
    "10.1186/s13059-022-02845-1",
    "10.1016/j.molp.2022.10.021",
    "10.1016/j.cell.2024.10.050",
    "10.1038/s41589-023-01327-0",
    "10.1093/hr/uhae214",
    "10.1016/j.molp.2019.04.004",
    "10.1111/tpj.16487",
    "10.1101/2024.01.09.574680",
    "10.1016/j.xplc.2022.100306",
    "10.1111/ppl.14118",
    "10.1038/s41586-024-08383-z",
    "10.1016/j.devcel.2021.02.021",
    "10.1111/tpj.15458",
    "10.1111/tpj.70064",
    "10.1111/pbi.13768",
    "10.1016/j.devcel.2024.01.001",
    "10.1016/j.cell.2021.04.014",
    "10.1038/s41477-024-01666-3",
    "10.3389/fpls.2022.988594",
    "10.1111/pbi.14097",
    "10.1073/pnas.2310881120",
    "10.1111/pce.15321",
    "10.1186/s13059-023-02886-0",
    "10.3389/fpls.2020.603302",
    "10.3389/fpls.2022.968158",
    "10.1016/j.celrep.2023.112676",
    "10.1111/nph.17992",
    "10.1016/j.molp.2021.01.001",
    "10.1016/j.devcel.2022.04.011",
    "10.1111/jipb.13159",
    "10.1038/s41477-021-01017-6",
    "10.1101/2024.03.04.583414",
    "10.1016/j.celrep.2024.114524",
    "10.1186/s13059-023-03032-6",
    "10.1111/pce.15459",
    "10.1038/s41477-021-01015-8",
    "10.1093/plcell/koab025",
    "10.1016/j.jhazmat.2024.136185",
    "10.1111/pce.14585",
    "10.1016/j.plaphy.2024.108857",
    "10.1126/science.aav6428",
    "10.3389/fpls.2024.1446561",
    "10.1007/s44154-024-00189-3",
    "10.1016/j.celrep.2019.04.054",
    "10.1093/plcell/koac167",
    "10.7554/eLife.31700",
    "10.1016/j.xplc.2024.100979",
    "10.1073/pnas.2303758120",
    "10.1038/s42003-021-02676-z",
    "10.1038/s41477-024-01854-1",
    "10.1016/j.jgg.2021.06.001",
    "10.1038/s41477-024-01683-2",
    "10.1016/j.celrep.2024.113747",
    "10.1016/j.molp.2021.07.021",
    "10.1038/s41467-021-23675-y",
    "10.1186/s12870-024-05574-8",
    "10.1111/pbi.14306",
    "10.1038/s41467-022-30177-y",
    "10.1242/dev.199589",
    "10.1111/pbi.13918",
    "10.1111/tpj.16315",
    "10.3389/fpls.2023.1200014",
    "10.1105/tpc.18.00785",
    "10.1016/j.xplc.2024.100984",
    "10.1111/pbi.14035",
    "10.1016/j.devcel.2023.05.014",
    "10.1016/j.molp.2021.05.028",
    "10.1016/j.celrep.2025.115240",
    "10.1111/nph.18008",
    "10.1038/s41467-024-55485-3",
    "10.1186/s12864-024-11186-1",
    "10.1111/pbi.14537",
    "10.1016/j.devcel.2024.05.016",
    "10.1016/j.ydbio.2024.11.004",
    "10.1186/s12915-022-01473-2",
    "10.1016/j.molp.2024.06.007",
    "10.1101/2024.01.08.574753",
    "10.1073/pnas.2402781121",
    "10.1038/s41477-023-01405-0",
    "10.1126/science.ads6601",
    "10.1038/s41586-023-06053-0"
]

DOI_BASE = "https://doi.org/"

# Common phrases found on reject/decline cookie buttons
REJECT_SELECTORS = [
    'button:text("Reject")',
    'button:text("Reject all")',
    'button:text("Decline")',
    'button:text("Decline all")',
    'button:text("Only necessary")',
    'button:text("Use necessary only")',
    '[aria-label="Reject all"]',
    '[id*="reject"]',
    '[class*="reject"]'
]


async def try_reject_cookies(page):
    for selector in REJECT_SELECTORS:
        try:
            button = await page.wait_for_selector(selector, timeout=100)
            await button.click()
            print(f"Rejected cookies using selector: {selector}")
            return
        except PlaywrightTimeoutError:
            continue  # Try the next selector
    print("No cookie reject button found.")


async def open_doi_tabs(dois):
    async with async_playwright() as p:
        browser = await p.chromium.launch(headless=False)
        context = await browser.new_context()

        for doi in dois:
            url = DOI_BASE + doi
            page = await context.new_page()
            await page.goto(url)
            await try_reject_cookies(page)
            print(f"Opened {url}")

        print("All DOI tabs opened. Press CTRL+C to exit when done.")
        await asyncio.sleep(36000)


if __name__ == "__main__":
    asyncio.run(open_doi_tabs(DOIS))